"use strict";angular.module("myApp",["app.auth","app.config","app.navbar","app.role","app.user","app.utility","ngCookies"]).factory("authInterceptor",["$q","$rootScope","SharedAuth",function(a,b,c){return{request:function(a){return b.loggedIn&&(a.headers=a.headers||{},c.isLoggedIn()&&c.decorateHeader(a.headers)),a},responseError:function(b){return 401===b.status?(c.logOut(),a.reject(b)):a.reject(b)}}}]).config(["$locationProvider","$routeProvider","$httpProvider",function(a,b,c){a.hashPrefix("!"),c.interceptors.push("authInterceptor"),b.otherwise({redirectTo:"/users/list"})}]).run(["$rootScope","$route","Auth","Config","Shared","SharedAuth",function(a,b,c,d,e,f){a.authenticated=!1,d.get().then(function(d){e.setConfig(d),f.isLoggedIn()&&(a.loggedIn=!0,c.getCurrentUser().then(function(d){a.authenticated=c.isAuthorized(),a.authenticated&&b.reload()}))})}]),angular.module("app.config",[]).service("Config",["$http",function(a){var b=this;this.url="api/config",this.config=null,this.get=function(){if(null!==b.config)return b.config;var c=a({url:b.url,withCredentials:!0});return c.then(function(a){return b.config=a.data,a.data},function(a){return console.log(a),a})}}]),angular.module("app.user",["ngRoute","ng.simple.table","ng.simple.pagination","app.role","app.config"]),angular.module("app.user").config(["$routeProvider",function(a){a.when("/users/list",{templateUrl:"app/user/partials/list.html",controller:"UsersCtrl",controllerAs:"ctrl",resolve:{users:["userService","Auth",function(a,b){return a.getPage(0).then(function(a){return a})["catch"](function(a){return console.log(a),[]})}]}}).when("/users/create",{templateUrl:"app/user/partials/create.html",controller:"NewUserCtrl",controllerAs:"ctrl"}).when("/users/edit/:id",{templateUrl:"app/user/partials/edit.html",controller:"UserCtrl",controllerAs:"ctrl",resolve:{user:["userService","$route",function(a,b){return a.getOne(b.current.params.id).then(function(a){return a})["catch"](function(a){return console.log(a),null})}]}}).when("/users/view/:id",{templateUrl:"app/user/partials/view.html",controller:"UserCtrl",controllerAs:"ctrl",resolve:{user:["userService","$route",function(a,b){return a.getOne(b.current.params.id).then(function(a){return a})["catch"](function(a){return console.log(a),null})}]}}).when("/users/delete/:id",{templateUrl:"app/user/partials/delete.html",controller:"UserCtrl",controllerAs:"ctrl",resolve:{user:["userService","$route",function(a,b){return a.getOne(b.current.params.id).then(function(a){return a})["catch"](function(a){return console.log(a),null})}]}})}]),angular.module("app.user").controller("UserCtrl",["$location","$scope","$window","alertService","userService","user",function(a,b,c,d,e,f){var g=this;g.user=f,g.submitUpdateUserForm=function(){_.isEmpty(g.updateUserForm.$error)&&e.update(_.pick(g.updateUserForm,["name","password","email"])).then(function(b){d.showSuccessMessage("Changes successfully saved");var c="users/view/"+g.updateUserForm.name;a.path(c)})["catch"](function(a){d.showErrorMessage("Entry was not updated")})},g.deleteOne=function(b){e["delete"](b).then(function(c){d.showSuccessMessage(b+" successfully deleted"),a.path("users/list")})["catch"](function(){d.showErrorMessage("Entry was not created")})},g.cancelDelete=function(){c.history.back()}}]),angular.module("app.user").controller("UsersCtrl",["$filter","$location","$scope","alertService","Auth","Shared","userService","userDecoratorService","users",function(a,b,c,d,e,f,g,h,i){function j(a){a&&a.rows&&a.rows.length>0&&a.rows[0].value?k.users=_.map(a.rows,"value"):k.users=a.rows,k.config.usersTable.derivedFields&&h.decorate(k.config.usersTable.derivedFields,k.users),k.simplePaginationConfig.total=a.total_rows,k.simplePaginationConfig.offset=a.offset}var k=this;k.searchString="",k.selection=[],k.config=f.getConfig(),k.simpleTableConfig=k.config.usersTable,k.simpleTableConfig.workspace=k.config.usersTable||"umsWorkspace",k.simplePaginationConfig={currentPage:0,total:i.total_rows,offset:i.offset,pageSize:k.config.pagination.pageSize},k.sortOptions={by:null,direction:null},k.users=_.map(i.rows,"value"),c.users=i,c.$watch("users",function(a,b){void 0!==a&&null!==a&&(j(c.users),c.users=null)}),k.onSearchStringChanged=function(){k.searchString=k.searchString.trim(),k.requestPage(0,k.config.pagination.pageSize)},k.requestPage=function(a,b){0===a&&(k.simplePaginationConfig.offset=0,k.simplePaginationConfig.currentPage=0);var c=0===k.searchString.length?g.getPage(a,k.config.pagination.pageSize,k.sortOptions.by,k.sortOptions.direction):g.search(a,k.config.pagination.pageSize,k.sortOptions.by,k.sortOptions.direction,k.searchString);c.then(function(a){j(a)})["catch"](function(a){console.log(a),j([])})},k.sort=function(a,b){k.sortOptions.by=a,k.sortOptions.direction=b,k.requestPage(0,k.config.pagination.pageSize)},k.rowActionCallback=function(a,c){var d="";switch(a){case 0:d="users/"+k.users[c][g.getSingleRecordKey()]+"/role/edit",b.path(d);break;case 1:d="users/edit/"+k.users[c][g.getSingleRecordKey()],b.path(d);break;case 2:d="users/view/"+k.users[c][g.getSingleRecordKey()],b.path(d);break;case 3:d="users/delete/"+k.users[c][g.getSingleRecordKey()],b.path(d)}},k.toggleFieldCalllback=function(a,b){var c=k.config.usersTable.toggleFields[a],d=k.users[b];if(c.hasOwnProperty("denyIf"))for(var f in c.denyIf){var h=0===c.denyIf[f].field.toLowerCase().indexOf("$currentuser$.")?e.getCurrentUser()[c.denyIf[f].field.split(".")[1]]:d[c.denyIf[f].field],i=0===c.denyIf[f].value.toLowerCase().indexOf("$currentuser$.")?e.getCurrentUser()[c.denyIf[f].value.split(".")[1]]:d[c.denyIf[f].value];if(h===i)return}d.hasOwnProperty(c.name)?d[c.name]===c.positive?d[c.name]=c.negative:d[c.name]=c.positive:c.hasOwnProperty("default")&&(d[c.name]=c["default"]),g.update(k.users[b])["catch"](function(a){toggleUserStatus(b)})},k.getSelectionCount=function(){return k.selection.filter(function(a){return a}).length}}]),angular.module("app.user").service("userService",["$http","Auth","Shared",function(a,b,c){var d=this;this.baseUrl="api/users",this.singleRecordKey="name",this.setBaseUrl=function(a){d.baseUrl=a.replace(/\/$/,"")},this.setSingleRecordKey=function(a){d.singleRecordKey=a},this.getSingleRecordKey=function(){return d.singleRecordKey},this.getPage=function(e,f,g,h){var i={},j=c.getConfig();j.filters.length>0&&_.forEach(j.filters,function(a){a.hasOwnProperty("field")&&(i[a.field.id]=b.getCurrentUser()[a.field.id]||a.field["default"])}),f||(f=30),g||(g="name"),h||(h="asc");var k=a({method:"GET",url:d.baseUrl,params:{skip:e,limit:f,sortBy:g,sortDirection:h,filterParams:i},withCredentials:!0});return k.then(function(a){return a.data},function(a){return a})},this.getOne=function(b){var c=a({url:d.baseUrl+"/"+b,withCredentials:!0});return c.then(function(a){return a.data})},this.search=function(e,f,g,h,i){var j={},k=c.getConfig();k.filters.length>0&&_.forEach(k.filters,function(a){a.hasOwnProperty("field")&&(j[a.field.id]=b.getCurrentUser()[a.field.id]||a.field["default"])}),g||(g="name"),h||(h="asc");var l=a({url:d.baseUrl+"/search/"+i,params:{skip:e,limit:f,sortBy:g,sortDirection:h,filterParams:j},withCredentials:!0});return l.then(function(a){return a.data})},this.create=function(b){b._id="org.couchdb.user:"+b.name;var c=a({method:"POST",url:d.baseUrl,data:b,withCredentials:!0});return c.then(function(){return delete b.password,b})},this.update=function(b){return a({method:"PUT",url:d.baseUrl+"/"+b[d.singleRecordKey],withCredentials:!0,data:b}).then(function(a){return a})},this["delete"]=function(b){return a({method:"DELETE",url:d.baseUrl+"/"+b,withCredentials:!0}).then(function(a){return a})}}]),angular.module("app.user").controller("NewUserCtrl",["$location","$scope","alertService","userService",function(a,b,c,d){var e=this;e.submitNewUserForm=function(){_.isEmpty(e.newUserForm.$error)&&d.create(_.pick(e.newUserForm,["name","password","email"])).then(function(){c.showSuccessMessage(e.newUserForm.name+" successfully created");var b="users/view/"+e.newUserForm.name;a.path(b)})["catch"](function(a){return"ValidationError"===a.data.name?void(e.newUserForm.$serverError=e.newUserForm.name):void c.showErrorMessage("Entry was not created")})}}]),angular.module("app.user").service("userDecoratorService",function(){this.methods={},this.decorate=function(a,b){}}),angular.module("app.role",["ngRoute","app.user"]).config(["$routeProvider",function(a){a.when("/users/:id/role/edit",{templateUrl:"app/role/partials/edit.html",controller:"RoleCtrl",controllerAs:"ctrl",resolve:{user:["userService","$route",function(a,b){return a.getOne(b.current.params.id).then(function(a){return a})["catch"](function(a){return console.log(a),null})}],adminLevels:["adminLevelService",function(a){return a.getAll().then(function(a){return a})["catch"](function(a){return console.log(a),[]})}],locations:["locationService",function(a){return a.getAll().then(function(a){return a})["catch"](function(a){return console.log(a),[]})}],facilities:["facilityService",function(a){return a.getAll().then(function(a){return a})["catch"](function(a){return console.log(a),[]})}],programs:["programService",function(a){return a.getAll().then(function(a){return a})["catch"](function(a){return console.log(a),[]})}],facilityPrograms:["facilityProgramsService",function(a){return a.getAll().then(function(a){return a})["catch"](function(a){return console.log(a),[]})}]}})}]),angular.module("app.role").controller("ViewRoleCtrl",["$scope","$q","adminLevelService","facilityService","locationService","programService",function(a,b,c,d,e,f){function g(){return!i.user.lomis_stock||_.isEmpty(i.user.lomis_stock.mobile)&&_.isEmpty(i.user.lomis_stock.dashboard)?"None":_.isEmpty(i.user.lomis_stock.mobile)?"Dashboard":"Mobile"}function h(){i.user.lomis_stock&&i.user.lomis_stock.dashboard&&(i.user.lomis_stock.dashboard.is_admin||!1)}var i=this;i.user=a.$parent.ctrl.user,i.hasNoRole=!i.user.lomis_stock,i.isAnAdmin=!1,i.role="None",i.adminLevel="Unknown Access Level",i.locations=[],i.programs=[],h(),i.init=function(){var a=b.all([c.getAll(),d.getAll(),e.getAll(),f.getAll()]);a.then(function(a){var b=_.keyBy(a[0],"_id"),c=_.keyBy(a[1],"_id"),d=_.keyBy(a[2],"_id"),e=_.keyBy(a[3],"_id");switch(i.role=g(),i.role){case"Mobile":i.adminLevel="Facility";var f=i.user.lomis_stock.mobile.facilities[0]||{},h=Object.keys(f)[0]||null,j=f[h]||[];c[h]&&(i.locations=[c[h].name]),i.programs=[],_.forEach(j,function(a){e[a]&&i.programs.push(e[a].name)});break;case"Dashboard":var k=i.user.lomis_stock.dashboard.access.level;b[k]&&(i.adminLevel=b[k].name);var l=i.user.lomis_stock.dashboard.access.items||[],m=[];_.forEach(l,function(a){a[k]&&(m=a[k])}),_.forEach(m,function(a){d[a]&&i.locations.push(d[a].name)});var n=i.user.lomis_stock.dashboard.access.programs||[];_.forEach(n,function(a){e[a]&&i.programs.push(e[a].name)})}})}}]),angular.module("app.role").controller("RoleCtrl",["$scope","$location","userService","alertService","Config","user","adminLevels","locations","facilities","programs","facilityPrograms",function(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.user=f,l.config=e.get(),l.adminLevels=g,l.locations=h,l.facilities=i,l.programs=_.sortBy(j,["name"]),l.facilityPrograms=k,a.$watch("vm.updateUserRoleForm.access.level",function(a,b){l.getAssignedLocation()}),l.submitUpdateUserRoleForm=function(){if(!l.updateUserRoleForm.$error||_.isEmpty(l.updateUserRoleForm.$error)){var a={dashboard:{},mobile:{}};switch(l.updateUserRoleForm.type){case"mobile":if(!l.updateUserRoleForm.facility||!l.updateUserRoleForm.program)return;var e={};e[l.updateUserRoleForm.facility]=l.updateUserRoleForm.program,a.mobile.facilities=[e];break;case"dashboard":var f=-1;for(var g in l.adminLevels)if(l.adminLevels[g]._id===l.updateUserRoleForm.access.level){f=g;break}if(!l.updateUserRoleForm.locations[f+""])return;a.dashboard={access:{level:l.updateUserRoleForm.access.level,programs:l.updateUserRoleForm.access.programs},is_admin:l.updateUserRoleForm.is_admin||!1};var h={};h[l.updateUserRoleForm.access.level]=[l.updateUserRoleForm.locations[f+""]],a.dashboard.access.items=[h]}c.update({name:l.user.name,_id:l.user._id,lomis_stock:a}).then(function(a){d.showSuccessMessage("Changes successfully saved");var c="users/view/"+l.user.name;b.path(c)})["catch"](function(a){d.showErrorMessage("Entry was not updated"+a)})}},l.getAssignedLocation=function(){if(l.user.lomis_stock&&(l.user.lomis_stock.mobile||l.user.lomis_stock.dashboard))if(l.user.lomis_stock.mobile&&!_.isEmpty(l.user.lomis_stock.mobile)){if(l.updateUserRoleForm.facility)return void(l.updateUserRoleForm.program=null);var a=l.user.lomis_stock.mobile.facilities[0];l.updateUserRoleForm.facility=Object.keys(a)[0],l.updateUserRoleForm.program=l.user.lomis_stock.mobile.facilities[0][l.updateUserRoleForm.facility][0]}else if(l.user.lomis_stock.dashboard&&!_.isEmpty(l.user.lomis_stock.dashboard)){var b=l.user.lomis_stock.dashboard.access.level,c=l.user.lomis_stock.dashboard.access.items[0][b][0],d=null;for(var e in l.locations)if(l.locations[e]._id===c){d=l.locations[e];break}var f=_.orderBy(d.ancestors,["level"],["asc"]);l.updateUserRoleForm.locations=[];for(var e in f)l.updateUserRoleForm.locations[e]=f[e]._id;l.updateUserRoleForm.locations[f.length]=c}},l.getUserType=function(){if(f&&f.lomis_stock){if(f.lomis_stock.dashboard&&!_.isEmpty(f.lomis_stock.dashboard))return"dashboard";if(f.lomis_stock.mobile&&!_.isEmpty(f.lomis_stock.mobile))return"mobile"}return""}}]),angular.module("app.role").filter("getWithAncestors",function(){return function(a,b){if(!a||!b)return[];var c=[];for(var d in a)if(c.push(a[d]),a[d]._id===b)break;return c}}).filter("getChildrenLocation",function(){return function(a,b,c){return a.filter(function(a){return a.ancestors&&a.ancestors.length===c+1?a.ancestors.filter(function(a){return a._id===b&&a.level===c?!0:!1}).length>0:!1})}}).filter("getFacilitiesInLocation",function(){return function(a,b){if(b&&0!==b.length){var c=("location:"+b[(Object.keys(b).length-1).toString()]).replace(/\s/g,"-").toLowerCase();return a.filter(function(a){return a.location.ancestors?a.location.ancestors.filter(function(a){return a._id===c&&a.level===Object.keys(b).length-1}).length>0:!1})}return[]}}).filter("getProgramsInFacility",function(){return function(a,b,c){if(c&&b){var d=b.filter(function(a){return a.facility===c});return a.filter(function(a){return d.filter(function(b){return b.program===a._id}).length>0})}return[]}}).filter("getUserType",function(){return function(a){return a.lomis_stock?_.isEmpty(a.lomis_stock.mobile)&&_.isEmpty(a.lomis_stock.dashboard)?"None":_.isEmpty(a.lomis_stock.mobile)?"Dashboard":"Mobile":"Unassigned"}}),angular.module("app.role").service("adminLevelService",["$http",function(a){var b="/api/admin_level";this.getAll=function(){var c=a.get(b,{withCredentials:!0});return c.then(function(a){var b=[];for(var c in a.data)null===a.data[c].parent&&b.push(a.data[c]);for(var d=0;d<a.data.length;d++){var e=b[b.length-1]._id;for(var f in a.data)a.data[f].parent===e&&b.push(a.data[f])}return b},function(a){return a})}}]).service("facilityService",["$http",function(a){var b="/api/facilities";this.getAll=function(){var c=a.get(b,{withCredentials:!0});return c.then(function(a){return a.data},function(a){return a})}}]).service("facilityProgramsService",["$http",function(a){var b="/api/common/facility-program";this.getAll=function(){var c=a.get(b,{withCredentials:!0});return c.then(function(a){return a.data},function(a){return a})}}]).service("locationService",["$http",function(a){var b="/api/location";this.getAll=function(){var c=a.get(b,{withCredentials:!0});return c.then(function(a){return a.data},function(a){return a})}}]).service("programService",["$http",function(a){var b="/api/program";this.getAll=function(){var c=a.get(b,{withCredentials:!0});return c.then(function(a){return a.data},function(a){return a})}}]),angular.module("app.user").decorate("userDecoratorService",["$delegate","$q","Shared","adminLevelService","facilityService","locationService","programService",function(a,b,c,d,e,f,g){return a.decorate=function(a,h){var i=b.all([d.getAll(),e.getAll(),f.getAll(),g.getAll()]);return i.then(function(a){function b(a){return!a.lomis_stock||!a.lomis_stock.mobile||!a.lomis_stock.dashboard||_.isEmpty(a.lomis_stock.mobile)&&_.isEmpty(a.lomis_stock.dashboard)?"None":_.isEmpty(a.lomis_stock.mobile)?"Dashboard":"Mobile"}function d(c){switch(b(c)){case"Mobile":return"Facility";case"None":return"Unassigned";case"Dashboard":var d=c.lomis_stock.dashboard.access.level;for(var e in a[0])if(a[0][e]._id===d)return a[0][e].name;return"Unknown Access Level"}}function e(c){if("None"===b(c))return null;if("Mobile"===b(c)){var d=c.lomis_stock.mobile.facilities,e="";for(var f in d){var g=Object.keys(d[f]);if(g.length>0)for(var h in a[1])a[1][h]._id===g[0]&&(e+=a[1][h].name+" ")}return e}var i=c.lomis_stock.dashboard.access.level,j=c.lomis_stock.dashboard.access.items,k=null;for(var f in j)if(j[f][i]){k=j[f][i];break}var l="";for(var f in k)for(var h in a[2])a[2][h]._id===k[f]&&(l+=a[2][h].name);return l}function f(a){var c=[];switch(b(a)){case"Mobile":var d=a.lomis_stock.mobile.facilities[0]||{},e=Object.keys(d),f=[];_.forEach(e,function(a){_.forEach(d[e],function(a){f.push(a)})}),_.forEach(f,function(a){g[a]&&c.push(g[a].name)});break;case"Dashboard":var h=a.lomis_stock.dashboard.access.programs||[];_.forEach(h,function(a){g[a]&&c.push(g[a].name)})}return c}var g=_.keyBy(a[3],"_id"),i=c.getConfig().workSpace||"umsWorkspace";for(var j in h)h[j][i]={},h[j][i].admin_level=d(h[j]),h[j][i].location=e(h[j]),h[j][i].programs=f(h[j])})},a}]),angular.module("ng.simple.table",[]).filter("limitColumnWidth",function(){return function(a,b){return a&&a.length>=b?a.substring(0,b-4)+" ...":a}}).directive("ngsimpletable",function(){return{scope:{allowFilter:"=",allowSelect:"=",allowSort:"=",arrayFields:"=",derivedFields:"=",filterFieldClass:"@",filterFieldPlaceholder:"@",headerClass:"@",maxColWidth:"=",rowActions:"=",rowActionCallback:"&",rowActionClass:"@",rowActionClasses:"=",rowClass:"@",rowSelection:"=",sortCallback:"&",tableClass:"@",tableData:"=",tableHeader:"=",toggleFields:"=",toggleFieldCallback:"&",unsortableFields:"=",workSpace:"="},link:function(a,b,c){function d(){var b=[];for(var c in a.tableHeader)"object"==typeof a.tableHeader[c]?a.tableHeader[c].hasOwnProperty("field")&&b.push(a.tableHeader[c].field):b.push(a.tableHeader[c]);return b}function e(){for(var b=[],c=0;c<a.tableData.length;c++)b.push(!1);return b}a.rowSelection=e(),a.searchString="",a.selectAll=!1,a.tableDataCopy=a.tableData,a.toggleFieldsName=_.map(a.toggleFields,"name"),a.columns=d(),a.sortIndex=-1,a.$watch("tableData",function(b,c){a.rowSelection=e(),a.tableData.length>a.tableDataCopy.length&&(a.tableDataCopy=a.tableData)}),a.hasSubField=function(b){return"object"==typeof a.tableHeader[b]},a.getSubField=function(b){return a.tableHeader[b].subFields},a.getSubFieldEntry=function(a,b){var c=b.split("."),d=a;for(var e in c){if(!d.hasOwnProperty(c[e]))return null;d=d[c[e]]}return d},a.getRowEntry=function(b,c){c.split(".");return a.derivedFields.indexOf(c)>=0?(b[a.workSpace]||(b[a.workSpace]={}),b[a.workSpace][c]):b[c]},a.filter=function(){a.tableData=a.tableDataCopy,a.searchString&&0!==a.searchString.length&&(a.tableData=a.tableData.filter(function(b){for(var c in a.tableHeader)if(b[a.tableHeader[c]].toString().toLowerCase().startsWith(a.searchString.toLowerCase()))return!0;return!1})),a.rowSelection=e()},a.sort=function(b){var c=a.tableHeader[b];"object"==typeof a.tableHeader[b]&&(c=a.tableHeader[b].field),a.sortBy&&a.sortBy===c?a.sortDirection&&"asc"===a.sortDirection?a.sortDirection="desc":a.sortDirection="asc":(a.sortBy=c,a.sortDirection="asc",a.sortIndex=b),a.sortCallback({by:a.sortBy,direction:a.sortDirection})},a.toggleSelectAll=function(){a.rowSelection=a.rowSelection.map(function(){return a.selectAll})}},restrict:"AEC",replace:!0,templateUrl:"components/ng-simple-table/template.html"}}),angular.module("ng.simple.pagination",[]).directive("ngsimplepagination",function(){return{scope:{currentPage:"=",total:"=",pageSize:"=",offset:"=",onPageRequested:"&"},link:function(a,b,c){function d(b){a.currentPage=b,a.pageStart=a.currentPage*a.pageSize+1,a.pageEnd=a.pageStart+a.pageSize-1,a.pageStart>a.total&&(a.pageStart=a.total),a.pageEnd>a.total&&(a.pageEnd=a.total);var c=b*a.pageSize;0>c&&(c=0),a.onPageRequested({limit:a.pageStart,skip:c})}function e(){a.pageCount=Math.ceil(a.total/a.pageSize),a.pageStart=a.currentPage*a.pageSize+1,a.pageEnd=a.pageStart+a.pageSize-1,a.pageStart>a.total&&(a.pageStart=a.total),a.pageEnd>a.total&&(a.pageEnd=a.total)}a.pageCount=0,a.pageResized=!1,a.pageStart=0,a.pageEnd=0,a.$watch("total",function(a,b){e()}),a.$watch("currentPage",function(a,b){d(a)}),a.navigateTo=function(a){d(a)}},restrict:"AEC",replace:!0,templateUrl:"components/ng-simple-pagination/template.html"}}),angular.module("app.user").service("alertService",function(){this.showMessage=function(a){humane.log(a)},this.showSuccessMessage=function(a){humane.log(a,{addnCls:"humane-flatty-success"})},this.showInfoMessage=function(a){humane.log(a,{addnCls:"humane-flatty-info"})},this.showErrorMessage=function(a){humane.log(a,{addnCls:"humane-flatty-error"})}}),angular.module("app.navbar",[]).controller("navbarCtrl",["$http","$window","Auth","Shared",function(a,b,c,d){function e(){var a=c.getCurrentUser(),b=a,d=f.config.currentUser.nameField.split(".");for(var e in d)b=b[d[e]];f.username=b}var f=this;f.config=d.getConfig(),f.username="",e(),f.navigateTo=function(a,c){var d;switch(a){case 0:d=f.config.navigation.customNavbarLinks[c].url;break;case 1:d=f.config.navigation.sidebarLinks[c].url;break;case 2:d=f.config.navigation.userDropdown[c].url}0===d.indexOf("/")?b.location=b.location.protocol+"//"+b.location.host+d:b.location=d}}]),angular.module("app.utility",[]).factory("Shared",function(){function a(a){e=a}function b(){return e}function c(){return f}function d(a){f=a}var e=0,f={};return{getConfig:c,setConfig:d,getParentHeight:b,setParentHeight:a}}),angular.module("app.utility").directive("loader",["Shared",function(a){return{link:function(b,c,d){b.$watch(function(){return c.height()},function(b,c){a.setParentHeight(b)})}}}]).directive("loaders",["Shared",function(a){return{template:"<div class='preloader'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>",link:function(b,c,d){b.$watch(function(){return a.getParentHeight()},function(b,d){var e=a.getParentHeight(),f=e-84;c.css("height",f+"px")})}}}]),angular.module("app.utility").factory("Util",function(){function a(a,b){var c=a,d=b.split(".");for(var e in d){if(!c.hasOwnProperty(d[e]))return null;c=c[d[e]]}return c}return{getProperty:a}}),angular.module("app.auth",[]).factory("Auth",["$cookies","$http","$window","Shared","SharedAuth","Util",function(a,b,c,d,e,f){function g(){var a=d.getConfig();if(null!==j)return j;var c=b({url:a.currentUser.url,method:"GET",withCredentials:!0});return c.then(function(a){return j=a.data,a.data},function(a){return a})}function h(){if(i||(i=d.getConfig()),e.isLoggedIn()){var a=!0;if(i.access.denyIf)for(var b=0;b<i.access.denyIf.length;b++)if(i.access.denyIf[b].value===f.getProperty(j,i.access.denyIf[b].field)){a=!1;break}if(i.access.allowIf)for(var b=0;b<i.access.allowIf.length;b++)if(i.access.allowIf[b].value!==f.getProperty(j,i.access.allowIf[b].field)){a=!1;break}if(a)return!0}c.location.href=i.auth.redirectUrl}var i=null,j=null;return{getCurrentUser:g,isAuthorized:h}}]),angular.module("app.auth").factory("SharedAuth",["$cookies","$window","Shared",function(a,b,c){function d(b){var d=c.getConfig();switch(d.auth.type.toLowerCase()){case"cookies":var e=a.getObject(d.auth.cookies.name);"bearer"===d.auth.cookies.authType.toLowerCase()&&(b.Authorization="Bearer ".concat(e))}return b}function e(){var d=c.getConfig();switch(d.auth.type.toLowerCase()){case"cookies":if(void 0!==a.get(d.auth.cookies.name))return!0}b.location.href=d.auth.redirectUrl}function f(){var d=c.getConfig();switch(d.auth.type.toLowerCase()){case"cookies":a.remove(d.auth.cookies.name)}b.location.href=d.auth.redirectUrl}return{decorateHeader:d,isLoggedIn:e,logOut:f}}]);