<div>
  <div ng-show="allowFilter">
    <br>
    &nbsp;&nbsp;<input type="text" ng-change="filter()"  ng-class="{{filterFieldClass}}" ng-model="searchString" placeholder="{{filterFieldPlaceholder}}"/>
  </div>
  <table ng-class="tableClass">
    <thead >
    <th width = "5%" ng-show="allowSelect">
      <input type = "checkbox" ng-model="selectAll" ng-change = "toggleSelectAll()" />
    </th>
    <th ng-repeat = "head in columns" class = "{{headerClass}}">
      <a ng-if = "unsortableFields && unsortableFields.indexOf(head) >= 0">
        &nbsp; {{head.replace('_', ' ') | uppercase}} &nbsp;&nbsp;
      </a>

      <a ng-if="!unsortableFields || unsortableFields.indexOf(head) < 0"
         ng-href
         ng-click="sort($index)">
          <i class = "fa fa-angle-up" ng-if = "($index === sortIndex) && (sortDirection === 'desc')"></i>
          <i class = "fa fa-angle-down" ng-if = "($index === sortIndex) && (sortDirection === 'asc')"></i>
        &nbsp;  {{head.replace('_', ' ') | uppercase}} &nbsp;&nbsp;
      </a>
    </th>
    <th ng-show = "{{rowActions.length > 0}}" class = "{{headerClass}}" >ACTION</th>
    </thead>
    <tbody>
    <tr ng-repeat=" row in tableData" class = "{{rowClass}}">

      <td width = "5%" ng-show="allowSelect"><input type = "checkbox"  ng-model="rowSelection[$index]" /></td>

      <td ng-repeat="col in columns" class = "{{rowClass}}">

        <span ng-if = "toggleFieldsName.indexOf(col) < 0 && arrayFields.indexOf(col) < 0">
          {{row[col].toString() | limitColumnWidth : maxColWidth}}

          <span ng-if="hasSubField(columns.indexOf(col))"
                ng-repeat="field in getSubField(columns.indexOf(col))">

            <label class = "label label-default pull-right" ng-style="field.positiveColour !== undefined ? {'background-color':field.positiveColour} : ''"
                   ng-if="(field.displayMode.toLowerCase() === 'label') && (field.positive !== undefined) && (getSubFieldEntry(row, field.field) === field.positive)">
                {{field.positiveLabel}}
            </label>

            <label class = "label label-default pull-right" ng-style="field.negativeColour !== undefined ? {'background-color':field.negativeColour} : ''"
                   ng-if="(field.displayMode.toLowerCase() === 'label') && (field.negative !== undefined) && (getSubFieldEntry(row, field.field) === field.negative)">
                {{field.negativeLabel}}
            </label>

            <span class = "pull-right"
                  ng-if="field.displayMode.toLocaleLowerCase() === 'text'">
                  {{getSubFieldEntry(row, field.field)}}
            </span>

          </span>

        </span>

        <span ng-if = "toggleFieldsName.indexOf(col) < 0 && arrayFields.indexOf(col) >= 0">
          <label ng-repeat= "elem in row[col]" class = "label label-default" ng-class="['label-warning', 'label-info'][$index]">{{elem}}</label>
        </span>

        <span ng-if = "toggleFieldsName.indexOf(col) >= 0"
              ng-init = "colIndex = toggleFieldsName.indexOf(col)">
          <a href ng-click="toggleFieldCallback({fieldIndex: colIndex, rowIndex: $parent.$parent.$index})">
            <span  class = "glyphicon"
                   ng-class=" row[col] === toggleFields[colIndex].positive ? 'glyphicon-ok': 'glyphicon-remove' "></span>
          </a>
        </span>

      </td>
      <td ng-show = "{{rowActions.length > 0}}" class = "{{rowActionClass}}">
        <a href
           class = 'btn btn-default btn-xs'
           ng-repeat = "action in rowActions"
           ng-click = "rowActionCallback({actionIndex: $index, rowIndex: $parent.$index})">
          <span ng-show="{{rowActionClasses.length > 0}}"span aria-hiden="true" class="{{rowActionClasses[$index]}}" ></span>&nbsp;
          <span >{{action | uppercase}}</span>
        </a>
      </td>
    </tr>
    </tbody>
  </table>
</div>
