<div class="row list-header">
  <div class = "col-lg-12">
    <div class = ' page-header'>

      <div class="ma-list-button">
        <a class="btn btn-default pull-right "  href="#!/users/list">
          <span class="glyphicon glyphicon-list" aria-hidden="true"></span>&nbsp;<span class="hidden-xs ng-scope" translate="LIST">List</span>
        </a>
      </div>
      <h1>
        <span class="">Assign Roles&nbsp;<i>{{ctrl.user.name}}</i></span>
      </h1>
    </div>
  </div>
</div>
<div class = "grid">
  <div class="row" id="edit-view">
    <form class="col-lg-12 form-horizontal ng-pristine "
          name="updateUserRoleForm"
          ng-submit="ctrl.submitUpdateUserRoleForm()"
          novalidate>
      <div>
        <div id="username" class="form-field form-group has-feedback">
          <label for="name" class="col-sm-2 control-label">Username</label>
          <div  class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7">
            <input type="text" ng-model="ctrl.user.name" id="name" class="form-control"  disabled>
          </div>
        </div>

        <div id="usertype" class="form-field form-group has-feedback">
          <label for="type" class="col-sm-2 control-label">User Type</label>
          <div class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7"
               ng-init="ctrl.updateUserRoleForm.type=ctrl.getUserType()"
          >
            <select  id="type"
                     class="form-control"
                     ng-model="ctrl.updateUserRoleForm.type"
                     ng-required="true"
                     ng-options = "type as type for type in ctrl.config.roles"

            ></select>
          </div>
        </div>

        <div class="form-field form-group" ng-if="ctrl.updateUserRoleForm.type === 'dashboard'">
          <label for="password" class="col-sm-2 control-label ng-binding">Administrator</label>

          <div ng-class="" class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7">
            <input type="checkbox"  ng-model="ctrl.updateUserRoleForm.is_admin"  ng-init="ctrl.updateUserRoleForm.is_admin = ctrl.user.lomis_stock.dashboard.is_admin" class="form-control" ng-true-value="true" ng-false-value="false" >
          </div>
        </div>

        <div  class="form-field form-group has-feedback" ng-if="ctrl.updateUserRoleForm.type === 'dashboard'">
          <label for="accessLevel" class="col-sm-2 control-label">Access Level</label>
          <div class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7"
               ng-init="ctrl.updateUserRoleForm.access.level =  ctrl.user.lomis_stock.dashboard.access.level"
          >
            <select  id="accessLevel"
                     class="form-control"
                     ng-model="ctrl.updateUserRoleForm.access.level"
                     ng-required="true"
                     ng-options ="adminLevel._id as adminLevel.name for adminLevel in ctrl.adminLevels"
                     ng-change="ctrl.getAssignedLocation()"
            ></select>
          </div>
        </div>

        <div ng-repeat = "adminLevel in ctrl.adminLevels | getWithAncestors : ctrl.updateUserRoleForm.access.level"
             class="form-field form-group has-feedback"
             ng-if="ctrl.updateUserRoleForm.type == 'dashboard' && ctrl.updateUserRoleForm.access.level">
          <label for="name" class="col-sm-2 control-label">{{adminLevel.name}}</label>
          <div class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7"
          >
            <select ng-if="$index === 0"
                    ng-model="ctrl.updateUserRoleForm.locations[$index]"  class="form-control"
                    ng-options="location._id as location.name for location in ctrl.locations | filter :{adminLevel: (  adminLevel._id)}"
                    ng-required="true"
            ></select>

            <select ng-if="$index > 0"
                    ng-model="ctrl.updateUserRoleForm.locations[$index]"  class="form-control"
                    ng-options="location._id as location.name for location in ctrl.locations | getChildrenLocation : ctrl.updateUserRoleForm.locations[$index - 1] : $index - 1"
                    ng-required="true"
            <!--ng-options ="location.name as location.name for location in locationsInAdminLevel[$index]"-->
            ></select>

          </div>
        </div>
        <div  class="form-field form-group has-feedback" ng-if="ctrl.updateUserRoleForm.type === 'mobile'">
          <label for="facility" class="col-sm-2 control-label">FACILIY</label>

          <div class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7">
            <select
              ng-model="ctrl.updateUserRoleForm.facility" id="facility" class="form-control"
              ng-options ="facility._id as facility.name for facility in ctrl.facilities"
              ng-required="true"
              ng-change="ctrl.getAssignedLocation()"
            ></select>
          </div>
        </div>
        <div id="usertype" class="form-field form-group has-feedback" ng-if="ctrl.updateUserRoleForm.type === 'mobile'">
          <label for="name" class="col-sm-2 control-label">PROGRAM</label>
          <div class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7">
            <div class="program_container">
              <span ng-repeat="program in ctrl.programs | getProgramsInFacility : ctrl.facilityPrograms : ctrl.updateUserRoleForm.facility">
                <input type="checkbox" ng-checked="ctrl.hasProgram(program._id)"  ng-model="selectedPrograms[$index]" ng-change="ctrl.toggleProgram(program._id)"/> {{program.name}}<br />
              </span>
            </div>
          </div>
          </div>
        </div>

      <div id="usertype" class="form-field form-group has-feedback" ng-if="ctrl.updateUserRoleForm.type === 'dashboard'">
        <label for="name" class="col-sm-2 control-label" ng-init="ctrl.updateUserRoleForm.access.programs =  ctrl.user.lomis_stock.dashboard.access.programs || []">PROGRAM</label>

        <div ng-class="" class="ng-admin-field-name ng-admin-type-string col-sm-10 col-md-8 col-lg-7">
          <!--select  ng-model="ctrl.updateUserRoleForm.access.programs"  class="form-control" id="programs"
                   ng-required="true"
                   multiple
                   ng-options ="program._id as program.name for program in ctrl.programs"
          ></select-->
          <div class="program_container">
              <span ng-repeat="program in ctrl.programs">
                <input type="checkbox" ng-checked="ctrl.hasDashboardProgram(program._id)"  ng-model="selectedPrograms[$index]" ng-change="ctrl.toggleDashboardProgram(program._id)"/> {{program.name}}<br />
              </span>
          </div>
        </div>
      </div>


        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-primary">
              <span class=""></span>&nbsp;
              <span class="hidden-xs ng-scope" translate="ASSIGN ROLE">Assign Role</span>
            </button>
          </div>
        </div>
    </form>
  </div>
  <div class="row">
    <div class="col-lg-12">
    </div>
  </div>
</div>
